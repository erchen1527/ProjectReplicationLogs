<!--
 * @FilePath: 
 * @Author: erchen
 * @Date: 2024-08-17 16:22:50
 * @LastEditTime: 2024-08-17 21:04:33
 * @Descripttion: 
-->

- [data/ood\_detection/cifar10.py](#dataood_detectioncifar10py)
- [train\_ensemble.py](#train_ensemblepy)
- [train.py](#trainpy)

以下修改根据个人修改顺序列举。

**注意：以下修改仅为个人调试方便进行，代码错误的地方已在1.1进行修改。不进行以下修改，代码也可运行。**

# data/ood_detection/cifar10.py

数据集存放与数据处理的代码在同一个目录，较为混乱，修改数据集存放的目录：

```git
@@ -50,7 +50,7 @@ def get_train_valid_loader(batch_size, augment, val_seed, val_size=0.1, num_work
         train_transform = transforms.Compose([transforms.ToTensor(), normalize,])
 
     # load the dataset
-    data_dir = "./data"
+    data_dir = "./dataset"
     train_dataset = datasets.CIFAR10(root=data_dir, train=True, download=True, transform=train_transform,)
 
     valid_dataset = datasets.CIFAR10(root=data_dir, train=True, download=False, transform=valid_transform,)
```

# train_ensemble.py

简化命名。

```git
--- a/train_ensemble.py
+++ b/train_ensemble.py
@@ -104,9 +104,9 @@ if __name__ == "__main__":
             schedulers[i].step()
 
         writer.add_scalar(args.model + "_ensemble_" + "train_loss", train_loss, (epoch + 1))
-        save_name = model_save_name(args.model, args.sn, args.mod, args.coeff, args.seed)
+        # save_name = model_save_name(args.model, args.sn, args.mod, args.coeff, args.seed)
         if (epoch + 1) % args.save_interval == 0:
             for i, model in enumerate(net_ensemble):
-                save_name = args.save_loc + save_name + str(args.seed+i) + "_" + str(epoch + 1) + ".model"
+                save_name = args.save_loc + args.model + "_epoch" + str(epoch + 1) + "_" + str(i) + ".model"
                 torch.save(model.state_dict(), save_name)
     writer.close()
```

# train.py

简化命名。

```git
@@ -105,8 +105,8 @@ if __name__ == "__main__":
 
     training_set_loss = {}
 
-    save_name = model_save_name(args.model, args.sn, args.mod, args.coeff, args.seed)
-    print("Model save name", save_name)
+    # save_name = model_save_name(args.model, args.sn, args.mod, args.coeff, args.seed)
+    # print("Model save name", save_name)
 
     for epoch in range(0, args.epoch):
         print("Starting epoch", epoch)
@@ -115,15 +115,15 @@ if __name__ == "__main__":
         )
 
         training_set_loss[epoch] = train_loss
-        writer.add_scalar(save_name + "_train_loss", train_loss, (epoch + 1))
+        # writer.add_scalar(save_name + "_train_loss", train_loss, (epoch + 1))
 
         scheduler.step()
 
         if (epoch + 1) % args.save_interval == 0:
-            saved_name = args.save_loc + save_name + "_" + str(epoch + 1) + ".model"
+            saved_name = args.save_loc + "epoch" + str(epoch + 1) + ".model"
             torch.save(net.state_dict(), saved_name)
 
-    saved_name = args.save_loc + save_name + "_" + str(epoch + 1) + ".model"
+    saved_name = args.save_loc + "epoch" + str(epoch + 1) + ".model"
     torch.save(net.state_dict(), saved_name)
     print("Model saved to ", saved_name)
```